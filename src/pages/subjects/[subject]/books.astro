---
export const prerender = false;
import {getEntry} from 'astro:content';
import DefaultLayout from '../../../layouts/DefaultLayout.astro';
import {app} from '../../../firebase/server';
import {getFirestore} from 'firebase-admin/firestore';
import {getAuth} from 'firebase-admin/auth';

const {subject} = Astro.params;
const subjectEntry = await getEntry('subjects',`guide/info/${subject}`);

const auth = getAuth(app);

if(subjectEntry === undefined || subjectEntry === null){
	return Astro.redirect('/404');
}
if(!Astro.cookies.has('session')){
	return Astro.redirect('/login');
}
const sessionCookie = Astro.cookies.get('session').value;
let decodedCookie;
try {
	decodedCookie = await auth.verifySessionCookie(sessionCookie);
}catch(err){
	Astro.cookies.set('session','', {expires : new Date(0)});
	return Astro.redirect('/login');
}
let user; 
try {
	user = await auth.getUser(decodedCookie.uid);
} catch(err){
	Astro.cookies.set('session','', {expires : new Date(0)});
	return Astro.redirect('/login');
}
---
<DefaultLayout title='Books'>
	<section class='container mx-auto px-2 pt-4 section-nav-pb'>
		<h2 class='text-slate-400 font-bold text-3xl text-center mb-4'>{subjectEntry.data.title}</h2>
		<h2 class='text-secondary font-bold text-3xl text-center mb-4 underline underline-offset-4'>Recommended</h2>
		<div class=' grid pb-4'>
			<ul>
				{
				subjectEntry.data.recommended_books.map((s) => (
					s.book.link === '' ? ('') : (
						<li><i class="fa-solid fa-book mr-2"></i>{s.book.name} - {s.book.edition}E - {s.book.author}</li>
					)
				))
				}
			</ul>
		</div>
		<hr/>
		<h2 class='text-secondary font-bold text-3xl text-center mb-4 underline underline-offset-4 pt-4'>PDF</h2>
		<div class='pdf grid grid-cols-3 max-md:grid-cols-2 max-sm:grid-cols-1 gap-2'>
			{
			subjectEntry.data.books.map((s) => (
				s.book.link === '' ? ('') : (
					<a target='_blank' href={s.book.link} class='bookPDF'>{s.book.name} - {s.book.author} (E{s.book.edition})</a>
				)
			))
			}
		</div>
	</section>
</DefaultLayout>
<style>
.bookPDF {
	@apply bg-lime-200 border-2 border-lime-600 text-lime-600 p-14 rounded-md text-center text-2xl font-bold;
}
</style>
